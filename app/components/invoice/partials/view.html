<section id="invoice-grid" class="inner" data-ng-controller="InvoiceController">
  <form name="invoice" id="invoice" class="row" >
    <article data-ui-view>
      <div class="panel panel-collapsible panel-default">
        <div class="panel-heading">
          <h3 data-toggle="collapse" data-target="#mainPanel" aria-label="Expand/Collapse the main AO content" id="mainPanelHeading">Invoice Details</h3>
        </div>
        <div id="mainPanel" name="invoice" class="panel-body in" aria-labelledby="mainPanelHeading" >
          <div class="row">
            <div class="form-group form-group-sm span-3" data-ng-class="{'has-error': (invoice.name.$dirty && invoice.name.$invalid), 'has-success': (invoice.name.$dirty && invoice.name.$valid)}" >
              <label id="nameLabel" for="name" class="control-label" aria-label="Invoice Name" >Invoice number*</label>
              <input type="text" class="form-control" id="name" name="name" placeholder="Invoice Ref" aria-labelledby="nameLabel"
              data-ng-model="context.name" data-ng-model-options="{ updateOn: 'default blur', debounce: { default: 650, blur: 0} }"
              data-kint-ui-input-feedback data-kint-validate required />

              <div data-ng-if="invoice.name.$dirty" data-ng-messages="invoice.name.$error" class="help-block" role="alert">
                <p data-ng-message="required">
                  Please enter a reference
                </p>
                <p data-ng-message="kintValidate">
                  {{invoice.name.kintValidate.message}}
                </p>
              </div>
            </div>
            <div class="form-group form-group-sm span-3" data-ng-class="{'has-error': (invoice.date.$dirty && invoice.date.$invalid), 'has-success': (invoice.date.$dirty && invoice.date.$valid)}" >
              <label id="dateLabel" for="date" class="control-label" aria-label="Invoice date" >Tax Date</label>
              <div class="input-group input-group-sm date" data-datetimepicker >
                <input type="text" class="form-control" id="date" name="date" aria-labelledby="dateLabel"
                data-ng-model="context.date" data-ng-model-options="{ updateOn: 'blur' }"
                data-kint-ui-input-feedback data-kint-validate />
                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
              </div>
              <div data-ng-if="invoice.date.$dirty" data-ng-messages="invoice.date.$error" class="help-block" role="alert">
                <p data-ng-message="kintValidate">
                  {{invoice.date.kintValidate.message}}
                </p>
              </div>
            </div>

            <div class="form-group form-group-sm span-3" data-ng-class="{'has-error': (invoice.dueDate.$dirty && invoice.dueDate.$invalid), 'has-success': (invoice.dueDate.$dirty && invoice.dueDate.$valid)}" >
              <label id="dateLabel" for="dueDate" class="control-label" aria-label="Invoice date" >Payment Due</label>
              <div class="input-group input-group-sm date" data-datetimepicker >
                <input type="text" class="form-control" id="dueDate" name="dueDate" aria-labelledby="dateLabel"
                data-ng-model="context.dueDate" data-ng-model-options="{ updateOn: 'blur' }"
                data-kint-ui-input-feedback data-kint-validate />
                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
              </div>
              <div data-ng-if="invoice.dueDate.$dirty" data-ng-messages="invoice.dueDate.$error" class="help-block" role="alert">
                <p data-ng-message="kintValidate">
                  {{invoice.dueDate.kintValidate.message}}
                </p>
              </div>
            </div>

            <!-- div class="form-group form-group-sm span-3" data-ng-class="{'has-error': (invoice.dueDate.$dirty && invoice.dueDate.$invalid), 'has-success': (invoice.dueDate.$dirty && invoice.dueDate.$valid)}" >
              <label id="supplierLabel" for="supplier" class="control-label" aria-label="Supplier" >Supplier</label>
              <kint-refdata-lookup name="supplier" id="supplier" data-object="context" data-property="supplier" aria-labelledby="supplierLabel"  class="form-control" tagging ></kint-refdata-lookup>
            </div -->
          </div>
        </div>
      </div>
      <!-- End Main Section -->

      <div class="panel panel-collapsible panel-default">
        <div class="panel-heading">
          <h3 data-toggle="collapse" data-target="#internalTrackingPanel" aria-label="Expand/Collapse the main AO content" id="internalTrackingPanelHeading">Internal Tracking</h3>
        </div>
        <div id="internalTrackingPanel" name="invoice" class="panel-body in" aria-labelledby="internalTrackingPanelHeading" >
          <div class="row" >
            <div class="form-group form-group-sm span-3">
              <label id="receivedLabel" for="received" class="control-label" aria-label="Received">Received*</label>
              <kint-refdata-lookup name="received" id="received" data-object="context" data-property="received" class="form-control input-sm" required >
            </div>
            <div data-ng-if="context.received.value === 'Yes'" class="form-group form-group-sm span-3" data-ng-class="{'has-error': (invoice.receivedDate.$dirty && invoice.receivedDate.$invalid), 'has-success': (invoice.receivedDate.$dirty && invoice.receivedDate.$valid)}" >
              <label id="receivedDateLabel" for="receivedDate" class="control-label" aria-label="Received Date" >Received Date*</label>
              <div class="input-group input-group-sm date" data-datetimepicker >
                <input type="text" class="form-control" id="receivedDate" name="receivedDate" aria-labelledby="receivedDateLabel"
                data-ng-model="context.receivedDate" data-ng-model-options="{ updateOn: 'blur' }"
                data-ng-required="context.received.value === 'Yes'"
                data-kint-ui-input-feedback data-kint-validate />
                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
              </div>
              <div data-ng-if="invoice.receivedDate.$dirty" data-ng-messages="invoice.receivedDate.$error" class="help-block" role="alert">
                <p data-ng-message="required">
                  Please enter a valid date
                </p>
                <p data-ng-message="kintValidate">
                  {{invoice.receivedDate.kintValidate.message}}
                </p>
              </div>
            </div>
          </div>
          <div class="row" >
            <div class="form-group form-group-sm span-3">
              <label id="passedToFinanceLabel" for="passedToFinance" class="control-label" aria-label="Received">Passed to Finance*</label>
              <kint-refdata-lookup name="passedToFinance" id="passedToFinance" data-object="context" data-property="passedToFinance" class="form-control input-sm" required >
            </div>
            <div data-ng-if="context.passedToFinance.value === 'Yes'" class="form-group form-group-sm span-3" data-ng-class="{'has-error': (invoice.passedToFinanceDate.$dirty && invoice.passedToFinanceDate.$invalid), 'has-success': (invoice.passedToFinanceDate.$dirty && invoice.passedToFinanceDate.$valid)}" >
              <label id="passedToFinanceDateLabel" for="passedToFinanceDate" class="control-label" aria-label="Received Date" >Passed to Finance Date*</label>
              <div class="input-group input-group-sm date" data-datetimepicker >
                <input type="text" class="form-control" id="passedToFinanceDate" name="passedToFinanceDate" aria-labelledby="passedToFinanceDateLabel"
                data-ng-model="context.passedToFinanceDate" data-ng-model-options="{ updateOn: 'blur' }"
                data-ng-required="context.passedToFinance.value === 'Yes'"
                data-kint-ui-input-feedback data-kint-validate />
                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
              </div>
              <div data-ng-if="invoice.passedToFinanceDate.$dirty" data-ng-messages="invoice.passedToFinanceDate.$error" class="help-block" role="alert">
                <p data-ng-message="required">
                  Please enter a valid date
                </p>
                <p data-ng-message="kintValidate">
                  {{invoice.passedToFinanceDate.kintValidate.message}}
                </p>
              </div>
            </div>
          </div>

          <div class="row" >
            <div class="form-group form-group-sm span-3">
              <label id="paidInFullLabel" for="paidInFull" class="control-label" aria-label="Paid in Full">Paid in Full*</label>
              <kint-refdata-lookup name="paidInFull" id="paidInFull" data-object="context" data-property="paidInFull" class="form-control input-sm" required >
            </div>
            <div data-ng-if="context.paidInFull.value === 'Yes'" class="form-group form-group-sm span-3" data-ng-class="{'has-error': (invoice.paidInFullDate.$dirty && invoice.paidInFullDate.$invalid), 'has-success': (invoice.paidInFullDate.$dirty && invoice.paidInFullDate.$valid)}" >
              <label id="paidInFullDateLabel" for="paidInFullDate" class="control-label" aria-label="Received Date" >Paid in Full*</label>
              <div class="input-group input-group-sm date" data-datetimepicker >
                <input type="text" class="form-control" id="paidInFullDate" name="paidInFullDate" aria-labelledby="paidInFullDateLabel"
                data-ng-model="context.paidInFullDate" data-ng-model-options="{ updateOn: 'blur' }"
                data-ng-required="context.paidInFull.value === 'Yes'"
                data-kint-ui-input-feedback data-kint-validate />
                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
              </div>
              <div data-ng-if="invoice.paidInFullDate.$dirty" data-ng-messages="invoice.paidInFullDate.$error" class="help-block" role="alert">
                <p data-ng-message="required">
                  Please enter a valid date
                </p>
                <p data-ng-message="kintValidate">
                  {{invoice.paidInFullDate.kintValidate.message}}
                </p>
              </div>
            </div>
          </div>

          <div class="row" >
            <div class="form-group form-group-sm span-6">
              <label id="paymentTypeLabel" for="paymentType" class="control-label" aria-label="Paid in Full">Payment Method*</label>
              <kint-refdata-lookup name="paymentType" id="paymentType" data-object="context" data-property="paymentType" class="form-control input-sm" required >
            </div>
            <div class="form-group form-group-sm span-6">
              <label id="filenameLabel" for="filename" class="control-label" aria-label="Paid in Full">Filename / location</label>
              <input type="text" class="form-control" id="filename" name="filename" placeholder="Invoice Filename" aria-labelledby="filenameLabel"
                data-ng-model="context.filename" data-ng-model-options="{ updateOn: 'default blur', debounce: { default: 650, blur: 0} }"
                data-kint-ui-input-feedback data-kint-validate />

              <div data-ng-if="invoice.filename.$dirty" data-ng-messages="invoice.filename.$error" class="help-block" role="alert">
                <p data-ng-message="kintValidate">
                  {{invoice.filename.kintValidate.message}}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End Internal Tracking -->

      <div class="panel panel-collapsible panel-default">
        <div class="panel-heading">
          <h3 data-toggle="collapse" data-target="#costItemsPanel" aria-label="Expand/Collapse the main AO content" id="costItemsPanelHeading">Invoice Lines / Cost Items</h3>
        </div>
        <div id="costItemsPanel" name="invoice" class="panel-body in" aria-labelledby="costItemsPanelHeading" >
          <form id="costItems" name="costItems" class="table-responsive" >
            <ng-include src="'components/invoice/partials/_table_cost_items.html'" ></ng-include>
          </form>
        </div>
      </div>
      <!-- End Internal Tracking -->

      <div class="panel panel-collapsible panel-default">
        <div class="panel-heading">
          <h3 data-toggle="collapse" data-target="#allNotes-container" aria-label="Expand/Collapse notes" id="allNotesHeading">Notes</h3>
        </div>
        <div class="panel-body form-horizontal in" id="allNotes"  data-object="context" data-property="notes" aria-labelledby="allNotesHeading"
          kint-ui-notes blank="getBlank(notes)" type="general" user="application.user" >
        </div>
      </div>
    </article>
    
    <div class="form-group">
      <button type="button" class="btn btn-danger" data-ng-click="doDelete()" data-ng-disabled="!context.id" >
        Delete
      </button>
      <div class="pull-right" >
        <button type="button" class="btn btn-success" data-ng-click="saveChanges()" data-ng-disabled="!invoice.$dirty || invoice.$invalid" >
          Save
        </button>
        <button type="button" class="btn btn-link" data-ng-disabled="!invoice.$dirty" >
          Cancel
        </button>
      </div>
    </div>
  </form>
</section>
